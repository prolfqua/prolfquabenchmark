<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarking normalization, aggregation and models using the Ionstar Dataset • prolfquabenchmark</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking normalization, aggregation and models using the Ionstar Dataset">
<meta property="og:description" content="prolfquabenchmark">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">prolfquabenchmark</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/BenchmarkFragPipeMSStats.html">DEA benchmark IonStar/FragPipeV14/MSstats.tsv</a>
    </li>
    <li>
      <a href="../articles/BenchmarkFragPipeProteinIonStar.html">DEA benchmark IonStar/FragPipeV14/combined_protein.tsv</a>
    </li>
    <li>
      <a href="../articles/BenchmarkMSqRob2.html">Benchmarking the msqrob2 package using the Ionstar Dataset starting from peptides.txt</a>
    </li>
    <li>
      <a href="../articles/Benchmark_MSStats.html">Benchmarking MSstats DEA using the Ionstar Dataset/MaxQuant</a>
    </li>
    <li>
      <a href="../articles/Benchmark_Model_IonStar_With2Factors.html">Modelling with Interactions</a>
    </li>
    <li>
      <a href="../articles/Benchmark_SaintExpress.html">Benchmarking SaintExpress</a>
    </li>
    <li>
      <a href="../articles/Benchmark_cptac.html">DEA benchmark CPTAC/MaxQuant/peptide.txt</a>
    </li>
    <li>
      <a href="../articles/Benchmark_proDA_fromMQlfq.html">Benchmarking the proDA package using the Ionstar Dataset MQ LFQ intensities</a>
    </li>
    <li>
      <a href="../articles/Benchmark_proDA_medpolish.html">Benchmarking the proDA package using the Ionstar Dataset starting from peptides</a>
    </li>
    <li>
      <a href="../articles/Benchmark_rlm.html">Benchmarking robust linear model using the Ionstar Dataset</a>
    </li>
    <li>
      <a href="../articles/BenchmarkingIonstarData.html">Benchmarking normalization, aggregation and models using the Ionstar Dataset</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wolski/proLFQuaBenchmark/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Benchmarking normalization, aggregation and
models using the Ionstar Dataset</h1>
                        <h4 data-toc-skip class="author">Witold
Wolski</h4>
            
            <h4 data-toc-skip class="date">2023-04-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/wolski/proLFQuaBenchmark/blob/HEAD/vignettes/BenchmarkingIonstarData.Rmd" class="external-link"><code>vignettes/BenchmarkingIonstarData.Rmd</code></a></small>
      <div class="hidden name"><code>BenchmarkingIonstarData.Rmd</code></div>

    </div>

    
    
<p>Please download and install the <code>prolfquadata</code> package
from github</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">conflicted</span><span class="fu">::</span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html" class="external-link">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="st">"dplyr"</span><span class="op">)</span></span></code></pre></div>
<p>Decide if you work with all data or for speedup with subset of
data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SUBSET</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">SUBSETNORM</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">SAVE</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>We start by loading the IonStar dataset and the annotation from the
<code>prolfquadata</code> package. The method
<code>add_annotation</code> adds the annotation to the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datadir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">find.package</a></span><span class="op">(</span><span class="st">"prolfquadata"</span><span class="op">)</span> , <span class="st">"quantdata"</span><span class="op">)</span></span>
<span><span class="va">inputMQfile</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">datadir</span>,</span>
<span>                          <span class="st">"MAXQuant_IonStar2018_PXD003881.zip"</span><span class="op">)</span></span>
<span><span class="va">inputAnnotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">datadir</span>, <span class="st">"annotation_Ionstar2018_PXD003881.xlsx"</span><span class="op">)</span></span>
<span><span class="va">mqdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mqdata</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/tidyMQ_Peptides.html" class="external-link">tidyMQ_Peptides</a></span><span class="op">(</span><span class="va">inputMQfile</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">mqdata</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">proteins</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 5295</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mqdata</span><span class="op">$</span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/concrete_AnalysisConfiguration.html" class="external-link">create_config_MQ_peptide</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">annotation</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_xlsx</a></span><span class="op">(</span><span class="va">inputAnnotation</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/add_annotation.html" class="external-link">add_annotation</a></span><span class="op">(</span></span>
<span>  <span class="va">mqdata</span><span class="op">$</span><span class="va">data</span>,</span>
<span>  <span class="va">annotation</span>,</span>
<span>  fileName <span class="op">=</span> <span class="st">"raw.file"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>setup_analysis</code> asserts that all columns specified in
the configruation are present in the data. For more details about the
<code>prolfqua</code> configuration see the vignette “Creating
Configurations”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">factors</span><span class="op">[[</span><span class="st">"dilution."</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"sample"</span></span>
<span><span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">factors</span><span class="op">[[</span><span class="st">"run_Id"</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="st">"run_ID"</span></span>
<span><span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">factorDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">mqdata</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/setup_analysis.html" class="external-link">setup_analysis</a></span><span class="op">(</span><span class="va">res</span>, <span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="data-filtering-and-normalization">Data filtering and normalization<a class="anchor" aria-label="anchor" href="#data-filtering-and-normalization"></a>
</h3>
<p>First we remove all contaminant, decoy proteins from the list, than
we remove 0 intensity values, then filter for 2 peptides per
protein.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqdata</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/LFQData.html" class="external-link">LFQData</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">mqdata</span><span class="op">$</span><span class="va">data</span>, <span class="va">mqdata</span><span class="op">$</span><span class="va">config</span><span class="op">)</span></span></code></pre></div>
<p>Filter the data for small intensities (maxquant reports missing
values as 0) and for two peptides per protein.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqdata</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^REV__|^CON__"</span>, <span class="va">protein_Id</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">filter_proteins_by_peptide_count</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">remove_small_intensities</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lfqdata</span><span class="op">$</span><span class="fu">hierarchy_counts</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   isotope protein_Id peptide_Id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> light         <span style="text-decoration: underline;">4</span>178      <span style="text-decoration: underline;">29</span>879</span></span></code></pre>
<p>We will normalize the data using the ‘LFQTransformer’ class. Since we
know that the Human proteins are the Matrix in the experiment we will
normalize the data using HUMAN proteins only. To this task we subset the
dataset by filtering for HUMAN proteins only and then use the
<code>LFQDataTransformer</code> to normalize the data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Transformer</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">subset_h</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_copy</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">subset_h</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">subset_h</span><span class="op">$</span><span class="va">data</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"HUMAN"</span>, <span class="va">protein_Id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">subset_h</span> <span class="op">&lt;-</span> <span class="va">subset_h</span><span class="op">$</span><span class="fu">get_Transformer</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">log2</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">lfq</span></span>
<span><span class="va">lfqdataNormalized</span> <span class="op">&lt;-</span> <span class="va">tr</span><span class="op">$</span><span class="fu">log2</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">robscale_subset</span><span class="op">(</span>lfqsubset <span class="op">=</span> <span class="va">subset_h</span>,  preserveMean <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">)</span><span class="op">$</span><span class="va">lfq</span></span></code></pre></div>
<p>The figures below show the intensity distribution before and after
normalization.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">before</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">before</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/plotIntensityDistributions-1.png" width="480"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">after</span> <span class="op">&lt;-</span> <span class="va">lfqdataNormalized</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">after</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/plotIntensityDistributions-2.png" width="480"></p>
<p>Create a sample of N proteins to speed up computations of models and
contrasts.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="va">SUBSET</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span>  <span class="va">mqdataSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_sample</span><span class="op">(</span>size <span class="op">=</span> <span class="va">N</span>, seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span>  <span class="va">lfqNormSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdataNormalized</span><span class="op">$</span><span class="fu">get_sample</span><span class="op">(</span>size <span class="op">=</span> <span class="va">N</span>, seed <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span>  <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">hierarchy_counts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">mqdataSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_copy</span><span class="op">(</span><span class="op">)</span>  </span>
<span>  <span class="va">lfqNormSubset</span> <span class="op">&lt;-</span> <span class="va">lfqdataNormalized</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">hierarchy_counts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   isotope protein_Id peptide_Id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> light         <span style="text-decoration: underline;">4</span>178      <span style="text-decoration: underline;">29</span>879</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="inferring-protein-abundances-from-peptide-abundances">Inferring Protein abundances from Peptide abundances<a class="anchor" aria-label="anchor" href="#inferring-protein-abundances-from-peptide-abundances"></a>
</h2>
<p>We will be using the <code>LFQDataAggregator</code> class. To
estimate protein abundances using Tukey’s median polish we need to use
log2 transformed peptide abundances</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">get_response</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "transformedIntensity"</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="fu">intensity_distribution_density</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/aggregateMedpolish-1.png" width="960"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqAggMedpol</span> <span class="op">&lt;-</span> <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">get_Aggregator</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lfqAggMedpol</span><span class="op">$</span><span class="fu">medpolish</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The figure below shows the the peptide abundances used for estimation
and the protein abundance estimates (black line).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="va">lfqAggMedpol</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span>  <span class="va">xx</span><span class="op">$</span><span class="va">plots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>We can also estimate the protein abundances by adding the abundances
of the top N most abundant peptides. In this case we are using the
untransformed peptide abudances.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqAggregator</span> <span class="op">&lt;-</span> <span class="va">lfqdata</span><span class="op">$</span><span class="fu">get_Aggregator</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lfqAggregator</span><span class="op">$</span><span class="fu">mean_topN</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">topN</span> <span class="op">&lt;-</span> <span class="va">lfqAggregator</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">topN</span><span class="op">$</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-fitting">Model Fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h2>
<p>We will be fitting tree models to the data:</p>
<ul>
<li>The first model is a linear model as implemented by the R function
<code>lm</code> fitted to protein abundances inferred from peptide
abundances using the LFQAggregator.</li>
<li>The second model is mixed effects model implemented in the R
function <code>lmer</code> fitted to peptide abundances, where we model
the peptide measurements as repeated measurements of the protein.</li>
<li>The third model again is a linear model but fitted to peptide
abundances. By this we obtain for each peptide a linear model can
compute contrasts and then can aggregate them using the ROPECA
method.</li>
</ul>
<div class="section level3">
<h3 id="fitting-a-linear-model-to-the-protein-abundances">Fitting a linear model to the protein abundances<a class="anchor" aria-label="anchor" href="#fitting-a-linear-model-to-the-protein-abundances"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protLFQ</span> <span class="op">&lt;-</span> <span class="va">lfqAggMedpol</span><span class="op">$</span><span class="va">lfq_agg</span></span>
<span><span class="va">sr</span> <span class="op">&lt;-</span> <span class="va">protLFQ</span><span class="op">$</span><span class="fu">get_Summariser</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">sr</span><span class="op">$</span><span class="fu">hierarchy_counts</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">##   isotope protein_Id</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> light         <span style="text-decoration: underline;">4</span>178</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="st">"~ dilution."</span></span>
<span><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">protLFQ</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">get_response</span><span class="op">(</span><span class="op">)</span> , <span class="va">lmmodel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">modelFunction</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/strategy.html" class="external-link">strategy_lm</a></span><span class="op">(</span> <span class="va">lmmodel</span>, model_name <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modLinearProt</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/build_model.html" class="external-link">build_model</a></span><span class="op">(</span><span class="va">protLFQ</span><span class="op">$</span><span class="va">data</span>, <span class="va">modelFunction</span><span class="op">)</span></span>
<span><span class="va">modLinearProt</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/buildModelLM-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="fitting-a-mixed-effects-model-to-peptide-abundances">Fitting a mixed effects model to peptide abundances<a class="anchor" aria-label="anchor" href="#fitting-a-mixed-effects-model-to-peptide-abundances"></a>
</h3>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="st">"~ dilution. + (1|peptide_Id) + (1|sampleName)"</span></span>
<span><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">get_response</span><span class="op">(</span><span class="op">)</span> , <span class="va">lmmodel</span><span class="op">)</span></span>
<span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">modelFunction</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/strategy.html" class="external-link">strategy_lmer</a></span><span class="op">(</span> <span class="va">lmmodel</span>, model_name <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span></span>
<span><span class="va">modMixedProtLevel</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/build_model.html" class="external-link">build_model</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">data</span>, <span class="va">modelFunction</span><span class="op">)</span></span>
<span><span class="va">modMixedProtLevel</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/buildModelLMer-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="fitting-peptide-level-models">Fitting peptide level models<a class="anchor" aria-label="anchor" href="#fitting-peptide-level-models"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="st">"~ dilution."</span></span>
<span></span>
<span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="va">hierarchyDepth</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">lmmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">config</span><span class="op">$</span><span class="va">table</span><span class="op">$</span><span class="fu">get_response</span><span class="op">(</span><span class="op">)</span> , <span class="va">lmmodel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modelFunction</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/strategy.html" class="external-link">strategy_lm</a></span><span class="op">(</span> <span class="va">lmmodel</span>, model_name <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span></span>
<span><span class="va">modLMPepLevel</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/build_model.html" class="external-link">build_model</a></span><span class="op">(</span><span class="va">lfqNormSubset</span><span class="op">$</span><span class="va">data</span>,</span>
<span>                                       <span class="va">modelFunction</span>,</span>
<span>                                       subject_Id <span class="op">=</span> <span class="va">lfqNormSubset</span><span class="op">$</span><span class="fu">subject_Id</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">modLMPepLevel</span><span class="op">$</span><span class="fu">anova_histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/buildModelPeptide-1.png" width="480"></p>
</div>
</div>
<div class="section level2">
<h2 id="computing-contrasts">Computing Contrasts<a class="anchor" aria-label="anchor" href="#computing-contrasts"></a>
</h2>
<p>Once models are fitted contrasts can be computed. The R code below
defines all possible contrasts among conditions for the ionstar
dataset.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DEBUG</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="va">Contrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"dilution_(9/3)_3"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.a"</span>,</span>
<span>  <span class="st">"dilution_(9/4.5)_2"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.b"</span>,</span>
<span>  <span class="st">"dilution_(9/6)_1.5"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.c"</span>,</span>
<span>  <span class="st">"dilution_(9/7.5)_1.2"</span> <span class="op">=</span>   <span class="st">"dilution.e - dilution.d"</span>,</span>
<span>  </span>
<span>  <span class="st">"dilution_(7.5/3)_2.5"</span> <span class="op">=</span>   <span class="st">"dilution.d - dilution.a"</span>,</span>
<span>  <span class="st">"dilution_(7.5/4.5)_1.6(6)"</span> <span class="op">=</span>   <span class="st">"dilution.d - dilution.b"</span>,</span>
<span>  <span class="st">"dilution_(7.5/6)_1.25"</span> <span class="op">=</span>   <span class="st">"dilution.d - dilution.c"</span>,</span>
<span>  </span>
<span>  <span class="st">"dilution_(6/3)_2"</span> <span class="op">=</span>   <span class="st">"dilution.c - dilution.a"</span>,</span>
<span>  <span class="st">"dilution_(6/4.5)_1.3(3)"</span> <span class="op">=</span>   <span class="st">"dilution.c - dilution.b"</span>,</span>
<span>  </span>
<span>  <span class="st">"dilution_(4.5/3)_1.5"</span> <span class="op">=</span>   <span class="st">"dilution.b - dilution.a"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Contrasts</span><span class="op">)</span>,split <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ratio"</span> , <span class="st">"expected fold-change"</span><span class="op">)</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span><span class="va">tt</span>, contrast <span class="op">=</span>  <span class="va">Contrasts</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span></span>
<span>  <span class="va">tt</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"All possible Contrasts given 5 E. coli dilutions of the Ionstar Dataset"</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>All possible Contrasts given 5 E. coli dilutions of the Ionstar
Dataset</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">contrast</th>
<th align="left">ratio</th>
<th align="left">expected fold-change</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">init</td>
<td align="left">dilution.e - dilution.a</td>
<td align="left">(9/3)</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">X</td>
<td align="left">dilution.e - dilution.b</td>
<td align="left">(9/4.5)</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">X.1</td>
<td align="left">dilution.e - dilution.c</td>
<td align="left">(9/6)</td>
<td align="left">1.5</td>
</tr>
<tr class="even">
<td align="left">X.2</td>
<td align="left">dilution.e - dilution.d</td>
<td align="left">(9/7.5)</td>
<td align="left">1.2</td>
</tr>
<tr class="odd">
<td align="left">X.3</td>
<td align="left">dilution.d - dilution.a</td>
<td align="left">(7.5/3)</td>
<td align="left">2.5</td>
</tr>
<tr class="even">
<td align="left">X.4</td>
<td align="left">dilution.d - dilution.b</td>
<td align="left">(7.5/4.5)</td>
<td align="left">1.6(6)</td>
</tr>
<tr class="odd">
<td align="left">X.5</td>
<td align="left">dilution.d - dilution.c</td>
<td align="left">(7.5/6)</td>
<td align="left">1.25</td>
</tr>
<tr class="even">
<td align="left">X.6</td>
<td align="left">dilution.c - dilution.a</td>
<td align="left">(6/3)</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">X.7</td>
<td align="left">dilution.c - dilution.b</td>
<td align="left">(6/4.5)</td>
<td align="left">1.3(3)</td>
</tr>
<tr class="even">
<td align="left">X.8</td>
<td align="left">dilution.b - dilution.a</td>
<td align="left">(4.5/3)</td>
<td align="left">1.5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevantContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dilution_(9/7.5)_1.2"</span>,</span>
<span>                       <span class="st">"dilution_(7.5/6)_1.25"</span>,</span>
<span>                       <span class="st">"dilution_(6/4.5)_1.3(3)"</span>,</span>
<span>                       <span class="st">"dilution_(4.5/3)_1.5"</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">relevantContrasts</span>,split <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tt</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ratio"</span> , <span class="st">"expected fold-change"</span><span class="op">)</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span><span class="va">tt</span>, contrast <span class="op">=</span>  <span class="va">Contrasts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Contrasts</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">relevantContrasts</span><span class="op">]</span>, .before <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">tt</span>, caption <span class="op">=</span> <span class="st">"Contrasts used for benchmark."</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Contrasts used for benchmark.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="left">contrast</th>
<th align="left">ratio</th>
<th align="left">expected fold-change</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">init</td>
<td align="left">dilution.e - dilution.d</td>
<td align="left">(9/7.5)</td>
<td align="left">1.2</td>
</tr>
<tr class="even">
<td align="left">X</td>
<td align="left">dilution.d - dilution.c</td>
<td align="left">(7.5/6)</td>
<td align="left">1.25</td>
</tr>
<tr class="odd">
<td align="left">X.1</td>
<td align="left">dilution.c - dilution.b</td>
<td align="left">(6/4.5)</td>
<td align="left">1.3(3)</td>
</tr>
<tr class="even">
<td align="left">X.2</td>
<td align="left">dilution.b - dilution.a</td>
<td align="left">(4.5/3)</td>
<td align="left">1.5</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relevantContrasts</span> <span class="op">&lt;-</span> <span class="va">Contrasts</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Contrasts</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">relevantContrasts</span><span class="op">]</span></span></code></pre></div>
<p>There are, as of today, four contrasts classes in the package
<em>prolfqua</em>:</p>
<ul>
<li>‘ContrastsSimpleImputed’ : contrast computation with imputation of
fold changes and t-statistic estimation using pooled variances.</li>
<li>‘Contrasts’ : uses Wald test,</li>
<li>‘ContrastsModerated’ : applies variance moderation,</li>
<li>‘ContrastsROPECA’ implements difference and p-value aggregation</li>
</ul>
<div class="section level3">
<h3 id="contrasts-with-imputation">Contrasts with Imputation<a class="anchor" aria-label="anchor" href="#contrasts-with-imputation"></a>
</h3>
<p>In order to estimate differences (fold-changes), statistics and
p-values of proteins for which linear models could not be fitted because
of an excess of missing measurements, the following procedure is
applied. The mean abundance of a protein in a condition is computed. For
the proteins with no observation in a condition, we infer their
abundances by using the mean protein abundances observed only in one
sample per group. The standard deviation of the protein is estimated
using the pooled variances of the condition where the variance could be
estimated.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrImp</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/ContrastsMissing.html" class="external-link">ContrastsMissing</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">protLFQ</span>,</span>
<span>  <span class="va">relevantContrasts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plc</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">plc</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastImputed-1.png" width="480"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plc</span><span class="op">$</span><span class="fu">ma_plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastImputed-2.png" width="480"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plc</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastImputed-3.png" width="480"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allContrasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">allContrasts</span><span class="op">$</span><span class="va">imputation</span> <span class="op">&lt;-</span> <span class="va">contrImp</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrImp</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">benchmark_missing</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    model_description <span class="op">=</span> <span class="st">"med. polish and missingness modelling"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"prolfqua_missing"</span>,</span>
<span>    FDRvsFDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>score <span class="op">=</span> <span class="st">"FDR"</span>, desc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">benchmark_missing</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkImputed-1.png" width="480"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_missing</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkImputed-2.png" width="480"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">benchmark_missing</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of not estimated contrasts."</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of not estimated contrasts.</caption>
<thead><tr class="header">
<th align="right">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0</td>
<td align="right">4178</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">benchmark_missing</span><span class="op">$</span><span class="fu">pAUC_summaries</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bb</span><span class="op">$</span><span class="va">barp</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-5-1.png" alt="Summary of partial area under the ROC curve." width="480"><p class="caption">
Summary of partial area under the ROC curve.
</p>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">content</span>, caption <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">caption</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>AUC, and pAUC at 0.1 and 0.2 FPR for (NC) med. polish and
missingness modelling</caption>
<thead><tr class="header">
<th align="left">contrast</th>
<th align="left">what</th>
<th align="right">AUC</th>
<th align="right">pAUC_10</th>
<th align="right">pAUC_20</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">all</td>
<td align="left">diff</td>
<td align="right">91.9</td>
<td align="right">64.8</td>
<td align="right">77.3</td>
</tr>
<tr class="even">
<td align="left">all</td>
<td align="left">scaled.p.value</td>
<td align="right">92.2</td>
<td align="right">71.0</td>
<td align="right">77.7</td>
</tr>
<tr class="odd">
<td align="left">all</td>
<td align="left">statistic</td>
<td align="right">92.1</td>
<td align="right">70.1</td>
<td align="right">77.3</td>
</tr>
<tr class="even">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">diff</td>
<td align="right">92.1</td>
<td align="right">75.8</td>
<td align="right">81.6</td>
</tr>
<tr class="odd">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">scaled.p.value</td>
<td align="right">92.2</td>
<td align="right">79.1</td>
<td align="right">82.1</td>
</tr>
<tr class="even">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">statistic</td>
<td align="right">92.1</td>
<td align="right">78.0</td>
<td align="right">81.5</td>
</tr>
<tr class="odd">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">diff</td>
<td align="right">91.8</td>
<td align="right">67.6</td>
<td align="right">78.9</td>
</tr>
<tr class="even">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">scaled.p.value</td>
<td align="right">92.1</td>
<td align="right">72.7</td>
<td align="right">78.8</td>
</tr>
<tr class="odd">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">statistic</td>
<td align="right">91.9</td>
<td align="right">71.6</td>
<td align="right">78.3</td>
</tr>
<tr class="even">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">diff</td>
<td align="right">90.8</td>
<td align="right">57.3</td>
<td align="right">73.1</td>
</tr>
<tr class="odd">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">scaled.p.value</td>
<td align="right">91.2</td>
<td align="right">65.2</td>
<td align="right">73.7</td>
</tr>
<tr class="even">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">statistic</td>
<td align="right">91.2</td>
<td align="right">64.6</td>
<td align="right">73.5</td>
</tr>
<tr class="odd">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">diff</td>
<td align="right">92.9</td>
<td align="right">57.6</td>
<td align="right">75.3</td>
</tr>
<tr class="even">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">scaled.p.value</td>
<td align="right">93.2</td>
<td align="right">66.6</td>
<td align="right">76.4</td>
</tr>
<tr class="odd">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">statistic</td>
<td align="right">93.1</td>
<td align="right">65.7</td>
<td align="right">76.1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allBenchmarks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_missing</span> <span class="op">&lt;-</span> <span class="va">benchmark_missing</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="contrasts-from-linear-model">Contrasts from linear model<a class="anchor" aria-label="anchor" href="#contrasts-from-linear-model"></a>
</h3>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrProt</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/Contrasts.html" class="external-link">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">modLinearProt</span>, <span class="va">relevantContrasts</span><span class="op">)</span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrProt</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel1-1.png" width="480"></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel1-2.png" width="480"></p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allContrasts</span><span class="op">$</span><span class="va">Prot</span> <span class="op">&lt;-</span> <span class="va">contrProt</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProt</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">benchmark_Prot</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    model_description <span class="op">=</span> <span class="st">"med. polish and lm"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"prolfqua_lm"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">benchmark_Prot</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of not estimated contrasts."</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of not estimated contrasts.</caption>
<thead><tr class="header">
<th align="right">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">4042</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">74</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">26</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#benchmark_Prot$plot_score_distribution()</span></span>
<span><span class="va">benchmark_Prot</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel1-1.png" width="480"></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_Prot</span> <span class="op">&lt;-</span> <span class="va">benchmark_Prot</span></span></code></pre></div>
<div class="section level4">
<h4 id="adding-moderation">Adding Moderation<a class="anchor" aria-label="anchor" href="#adding-moderation"></a>
</h4>
</div>
</div>
<div class="section level3">
<h3 id="contrasts-from-mixed-effect-models">Contrasts from mixed effect models<a class="anchor" aria-label="anchor" href="#contrasts-from-mixed-effect-models"></a>
</h3>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrProtMixed</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/Contrasts.html" class="external-link">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">modMixedProtLevel</span>, <span class="va">relevantContrasts</span>, modelName <span class="op">=</span> <span class="st">"WaldTestMixed"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel2-1.png" width="480"></p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">p.value</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel2-2.png" width="480"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pl</span><span class="op">$</span><span class="va">protein_Id</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3939</span></span></code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allContrasts</span><span class="op">$</span><span class="va">contrProtMixed</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">benchmark_mixed</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    model_description <span class="op">=</span> <span class="st">"mixed effect model"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"prolfqua_mix_eff"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">benchmark_mixed</span><span class="op">$</span><span class="fu">complete</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">benchmark_mixed</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>,</span>
<span>                       caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of not estimated contrasts."</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of not estimated contrasts.</caption>
<thead><tr class="header">
<th align="right">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0</td>
<td align="right">3939</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#benchmark_mixed$plot_score_distribution()</span></span>
<span><span class="va">benchmark_mixed</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel2-1.png" width="480"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_mixed</span> <span class="op">&lt;-</span> <span class="va">benchmark_mixed</span></span></code></pre></div>
<div class="section level4">
<h4 id="adding-moderation-1">Adding Moderation<a class="anchor" aria-label="anchor" href="#adding-moderation-1"></a>
</h4>
<p>Since moderation requires a degrees of freedom estimate to determine
the prior degrees of freedom we examine the denominator degrees of
freedom produced by the methods implemented in lmerTest (see
Histogram).</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctr</span> <span class="op">&lt;-</span> <span class="va">contrProtMixed</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">ctr</span><span class="op">$</span><span class="va">df</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">df</span> <span class="op">&gt;</span> <span class="fl">59</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1]  1.465724 60.000000</span></span></code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">df</span>, breaks <span class="op">=</span> <span class="fl">100</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">61</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/distributionOfDFModel2-1.png" alt="Histogram of degrees of freedom for mixed model" width="480"><p class="caption">
Histogram of degrees of freedom for mixed model
</p>
</div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrProtMixedModerated</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/ContrastsModerated.html" class="external-link">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">contrProtMixed</span><span class="op">)</span></span>
<span><span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastModel2Moderation-1.png" width="480"></p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allContrasts</span><span class="op">$</span><span class="va">contrProtMixedModerated</span> <span class="op">&lt;-</span> <span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">contrProtMixedModerated</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">benchmark_mixedModerated</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    model_description <span class="op">=</span> <span class="st">"mixed effect model moderated"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"prolfqua_mix_eff_mod"</span><span class="op">)</span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">benchmark_mixedModerated</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of computed contrasts."</span>, digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of computed contrasts.</caption>
<thead><tr class="header">
<th align="right">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0</td>
<td align="right">3939</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#benchmark_mixedModerated$plot_score_distribution()</span></span>
<span><span class="va">benchmark_mixedModerated</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkModel2Moderation-1.png" width="480"></p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_mixedModerated</span> <span class="op">&lt;-</span> <span class="va">benchmark_mixedModerated</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="protein-level-contrasts-from-peptide-models">Protein level contrasts from peptide models<a class="anchor" aria-label="anchor" href="#protein-level-contrasts-from-peptide-models"></a>
</h3>
<p>To estimate regulation probabilities using the ROPECA approach we can
chain the contrast computation methods. First we compute contrasts on
peptide level, than we moderated the variance, t-statistics and p-values
and finally we aggregate the fold change estimates and p-values.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrastPep</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/Contrasts.html" class="external-link">Contrasts</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">modLMPepLevel</span>, <span class="va">relevantContrasts</span><span class="op">)</span> </span>
<span><span class="va">contrROPECA</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/ContrastsModerated.html" class="external-link">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span> <span class="va">contrastPep</span> <span class="op">)</span>  <span class="op">|&gt;</span>  <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/ContrastsROPECA.html" class="external-link">ContrastsROPECA</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">contrROPECA</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">volcano</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastROPECA-1.png" width="480"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contrROPECA</span><span class="op">$</span><span class="fu">get_Plotter</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">histogram</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FDR</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/contrastROPECA-2.png" width="480"></p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cr</span> <span class="op">&lt;-</span> <span class="va">contrROPECA</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">cr</span><span class="op">)</span></span>
<span><span class="va">benchmark_ropeca</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    toscale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta.based.significance"</span><span class="op">)</span>,</span>
<span>    benchmark <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>score <span class="op">=</span> <span class="st">"diff"</span>, desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>score <span class="op">=</span> <span class="st">"statistic"</span>, desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>score <span class="op">=</span> <span class="st">"scaled.beta.based.significance"</span>, desc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,  </span>
<span>    model_description <span class="op">=</span> <span class="st">"Ropeca"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"prolfqua_ropeca"</span>,</span>
<span>    FDRvsFDP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>score <span class="op">=</span> <span class="st">"FDR.beta.based.significance"</span>, desc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span></span>
<span>    <span class="va">benchmark_ropeca</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of not estimated contrasts."</span>,</span>
<span>    digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of not estimated contrasts.</caption>
<thead><tr class="header">
<th align="right">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">4016</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">16</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">79</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">36</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_ropeca</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkROPECA-1.png" width="480"></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_ropeca</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/benchmarkROPECA-2.png" width="480"></p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_ropeca</span> <span class="op">&lt;-</span> <span class="va">benchmark_ropeca</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">benchmark_ropeca</span><span class="op">$</span><span class="fu">pAUC_summaries</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bb</span><span class="op">$</span><span class="va">barp</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-7-1.png" alt="Summary of partial area under the ROC curve." width="480"><p class="caption">
Summary of partial area under the ROC curve.
</p>
</div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">content</span>, caption <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">caption</span>, digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>AUC, and pAUC at 0.1 and 0.2 FPR for (NC) Ropeca</caption>
<colgroup>
<col width="31%">
<col width="40%">
<col width="6%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">contrast</th>
<th align="left">what</th>
<th align="right">AUC</th>
<th align="right">pAUC_10</th>
<th align="right">pAUC_20</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">all</td>
<td align="left">diff</td>
<td align="right">92.1</td>
<td align="right">63.5</td>
<td align="right">77.3</td>
</tr>
<tr class="even">
<td align="left">all</td>
<td align="left">scaled.beta.based.significance</td>
<td align="right">94.1</td>
<td align="right">78.8</td>
<td align="right">84.7</td>
</tr>
<tr class="odd">
<td align="left">all</td>
<td align="left">statistic</td>
<td align="right">94.4</td>
<td align="right">77.8</td>
<td align="right">84.6</td>
</tr>
<tr class="even">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">diff</td>
<td align="right">93.7</td>
<td align="right">79.7</td>
<td align="right">86.0</td>
</tr>
<tr class="odd">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">scaled.beta.based.significance</td>
<td align="right">94.8</td>
<td align="right">84.1</td>
<td align="right">88.0</td>
</tr>
<tr class="even">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">statistic</td>
<td align="right">95.4</td>
<td align="right">85.8</td>
<td align="right">89.1</td>
</tr>
<tr class="odd">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">diff</td>
<td align="right">92.2</td>
<td align="right">67.6</td>
<td align="right">79.3</td>
</tr>
<tr class="even">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">scaled.beta.based.significance</td>
<td align="right">93.7</td>
<td align="right">80.7</td>
<td align="right">85.2</td>
</tr>
<tr class="odd">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">statistic</td>
<td align="right">94.3</td>
<td align="right">80.5</td>
<td align="right">85.7</td>
</tr>
<tr class="even">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">diff</td>
<td align="right">90.1</td>
<td align="right">52.7</td>
<td align="right">70.6</td>
</tr>
<tr class="odd">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">scaled.beta.based.significance</td>
<td align="right">92.9</td>
<td align="right">74.1</td>
<td align="right">81.5</td>
</tr>
<tr class="even">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">statistic</td>
<td align="right">93.1</td>
<td align="right">71.4</td>
<td align="right">80.4</td>
</tr>
<tr class="odd">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">diff</td>
<td align="right">92.4</td>
<td align="right">53.7</td>
<td align="right">73.2</td>
</tr>
<tr class="even">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">scaled.beta.based.significance</td>
<td align="right">94.9</td>
<td align="right">76.7</td>
<td align="right">84.2</td>
</tr>
<tr class="odd">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">statistic</td>
<td align="right">94.6</td>
<td align="right">74.4</td>
<td align="right">83.4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="merging-contrasts-of-two-models-">Merging contrasts of two models.<a class="anchor" aria-label="anchor" href="#merging-contrasts-of-two-models-"></a>
</h2>
<p>Here we merge contrasts estimates from linear models and from the
models with imputation using <code>merge_contrasts_results</code>. We
prefer the contrasts estimated with linear models and if missing augment
them with the contrasts estimated with imputation.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/merge_contrasts_results.html" class="external-link">merge_contrasts_results</a></span><span class="op">(</span>prefer <span class="op">=</span> <span class="va">contrProt</span>, add <span class="op">=</span> <span class="va">contrImp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/prolfqua/man/ContrastsModerated.html" class="external-link">ContrastsModerated</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">all</span><span class="op">$</span><span class="va">merged</span><span class="op">)</span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">merged</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">benchmark_merged</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    model_description <span class="op">=</span> <span class="st">"merge of prot moderated and imputed"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"prolfqua_merged"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span></span>
<span>  <span class="va">benchmark_merged</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of not estimated contrasts."</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Nr of proteins with Nr of not estimated contrasts.</caption>
<thead><tr class="header">
<th align="right">nr_missing</th>
<th align="right">protein_Id</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">0</td>
<td align="right">4178</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#benchmark_mixedModerated$plot_score_distribution()</span></span>
<span></span>
<span><span class="va">benchmark_merged</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/mergingContrasts-1.png" width="480"></p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_merged</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-9-1.png" alt="ROC curves for merged benchmark" width="960"><p class="caption">
ROC curves for merged benchmark
</p>
</div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">benchmark_merged</span><span class="op">$</span><span class="fu">pAUC_summaries</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bb</span><span class="op">$</span><span class="va">barp</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-9-2.png" alt="ROC curves for merged benchmark" width="960"><p class="caption">
ROC curves for merged benchmark
</p>
</div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">content</span>, caption <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">caption</span>, digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">content</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">contrast</th>
<th align="left">what</th>
<th align="right">AUC</th>
<th align="right">pAUC_10</th>
<th align="right">pAUC_20</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">all</td>
<td align="left">diff</td>
<td align="right">91.92328</td>
<td align="right">64.80872</td>
<td align="right">77.25999</td>
</tr>
<tr class="even">
<td align="left">all</td>
<td align="left">scaled.p.value</td>
<td align="right">92.45606</td>
<td align="right">72.28752</td>
<td align="right">78.82013</td>
</tr>
<tr class="odd">
<td align="left">all</td>
<td align="left">statistic</td>
<td align="right">92.39573</td>
<td align="right">71.69743</td>
<td align="right">78.54725</td>
</tr>
<tr class="even">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">diff</td>
<td align="right">92.08722</td>
<td align="right">75.84453</td>
<td align="right">81.59166</td>
</tr>
<tr class="odd">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">scaled.p.value</td>
<td align="right">92.21610</td>
<td align="right">78.39920</td>
<td align="right">81.60181</td>
</tr>
<tr class="even">
<td align="left">dilution_(4.5/3)_1.5</td>
<td align="left">statistic</td>
<td align="right">92.12471</td>
<td align="right">77.50427</td>
<td align="right">81.15853</td>
</tr>
<tr class="odd">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">diff</td>
<td align="right">91.75108</td>
<td align="right">67.63093</td>
<td align="right">78.92716</td>
</tr>
<tr class="even">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">scaled.p.value</td>
<td align="right">92.24825</td>
<td align="right">73.86413</td>
<td align="right">79.87700</td>
</tr>
<tr class="odd">
<td align="left">dilution_(6/4.5)_1.3(3)</td>
<td align="left">statistic</td>
<td align="right">92.18107</td>
<td align="right">73.25236</td>
<td align="right">79.57972</td>
</tr>
<tr class="even">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">diff</td>
<td align="right">90.77340</td>
<td align="right">57.34122</td>
<td align="right">73.11850</td>
</tr>
<tr class="odd">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">scaled.p.value</td>
<td align="right">91.61390</td>
<td align="right">67.53081</td>
<td align="right">75.51990</td>
</tr>
<tr class="even">
<td align="left">dilution_(7.5/6)_1.25</td>
<td align="left">statistic</td>
<td align="right">91.57258</td>
<td align="right">67.20265</td>
<td align="right">75.36089</td>
</tr>
<tr class="odd">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">diff</td>
<td align="right">92.92366</td>
<td align="right">57.61822</td>
<td align="right">75.27731</td>
</tr>
<tr class="even">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">scaled.p.value</td>
<td align="right">93.67899</td>
<td align="right">69.31494</td>
<td align="right">78.60628</td>
</tr>
<tr class="odd">
<td align="left">dilution_(9/7.5)_1.2</td>
<td align="left">statistic</td>
<td align="right">93.63532</td>
<td align="right">68.79403</td>
<td align="right">78.41243</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_merged</span> <span class="op">&lt;-</span> <span class="va">benchmark_merged</span></span></code></pre></div>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">same</span> <span class="op">&lt;-</span> <span class="va">all</span><span class="op">$</span><span class="va">same</span></span>
<span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_Prot</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span></span>
<span></span>
<span><span class="va">ttd</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/ionstar_bench_preprocess.html" class="external-link">ionstar_bench_preprocess</a></span><span class="op">(</span><span class="va">same</span><span class="op">$</span><span class="fu">get_contrasts</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">benchmark_same</span> <span class="op">&lt;-</span> <span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/make_benchmark.html" class="external-link">make_benchmark</a></span><span class="op">(</span></span>
<span>    <span class="va">ttd</span><span class="op">$</span><span class="va">data</span>,</span>
<span>    model_description <span class="op">=</span> <span class="st">"imputed_same_as_lm"</span>,</span>
<span>    model_name <span class="op">=</span> <span class="st">"imputed_same_as_lm"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">benchmark_same</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>, caption <span class="op">=</span> <span class="st">"Nr of proteins with Nr of not estimated contrasts."</span>, digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">benchmark_same</span><span class="op">$</span><span class="fu">plot_FDRvsFDP</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">benchmark_same</span><span class="op">$</span><span class="fu">plot_ROC</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">benchmark_same</span><span class="op">$</span><span class="fu">pAUC_summaries</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bb</span><span class="op">$</span><span class="va">barp</span></span>
<span></span>
<span><span class="fu">prolfqua</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/prolfqua/man/table_facade.html" class="external-link">table_facade</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">content</span>, caption <span class="op">=</span> <span class="va">bb</span><span class="op">$</span><span class="va">ftable</span><span class="op">$</span><span class="va">caption</span>, digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">allBenchmarks</span><span class="op">$</span><span class="va">benchmark_same</span> <span class="op">&lt;-</span> <span class="va">benchmark_same</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-various-models">Comparing various models<a class="anchor" aria-label="anchor" href="#comparing-various-models"></a>
</h2>
<p>The table below summarizes the contrast estimates produced which will
be benchmarked.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="21%">
<col width="12%">
<col width="15%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th></th>
<th align="center">Model</th>
<th>Contrast</th>
<th>Moderation</th>
<th>Aggregation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Protein abudance</td>
<td align="center">lm</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr class="even">
<td>Protein abudance Imputed</td>
<td align="center">pooled variance</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr class="odd">
<td>Peptide abudance</td>
<td align="center">lmer</td>
<td>o</td>
<td>o</td>
<td></td>
</tr>
<tr class="even">
<td>Peptide abudance</td>
<td align="center">lm</td>
<td></td>
<td></td>
<td>o</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ttt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="fu">complete</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">$</span><span class="fu">pAUC</span><span class="op">(</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">resAllB</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">contrast</span> <span class="op">==</span> <span class="st">"all"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="va">resAllB</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>whatfix <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">what</span> <span class="op">==</span> <span class="st">"scaled.beta.based.significance"</span> <span class="op">~</span> <span class="st">"scaled.p.value"</span>, <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">what</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bb</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Name</span>, y <span class="op">=</span> <span class="va">pAUC_10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">whatfix</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">pAUC_10</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">pAUC_10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-11-1.png" alt="Partial area under the ROC curve at 10% FPR." width="480"><p class="caption">
Partial area under the ROC curve at 10% FPR.
</p>
</div>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">bb</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Name</span>, y <span class="op">=</span> <span class="va">pAUC_20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">whatfix</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">pAUC_20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">bb</span><span class="op">$</span><span class="va">pAUC_20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-12-1.png" width="480"></p>
<div class="section level4">
<h4 id="look-at-the-nr-of-estimated-contrasts-">Look at the nr of estimated contrasts.<a class="anchor" aria-label="anchor" href="#look-at-the-nr-of-estimated-contrasts-"></a>
</h4>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">smc</span><span class="op">$</span><span class="va">summary</span>; <span class="va">res</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">model_name</span>;<span class="va">res</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="va">dd</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nrcontrasts <span class="op">=</span> <span class="va">protein_Id</span> <span class="op">*</span> <span class="op">(</span><span class="fl">4</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">nr_missing</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dds</span> <span class="op">&lt;-</span> <span class="va">dd</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>nrcontrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">nrcontrasts</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dds</span> <span class="op">|&gt;</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">name</span>, y <span class="op">=</span> <span class="op">(</span><span class="va">nrcontrasts</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">nrcontrasts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label<span class="op">=</span> <span class="va">nrcontrasts</span><span class="op">)</span>, position <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span>, vjust<span class="op">=</span><span class="op">-</span><span class="fl">0.25</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/unnamed-chunk-13-1.png" alt="NR of estimated contrasts" width="480"><p class="caption">
NR of estimated contrasts
</p>
</div>
</div>
<div class="section level4">
<h4 id="plot-fdr-vs-fdp">Plot FDR vs FDP<a class="anchor" aria-label="anchor" href="#plot-fdr-vs-fdp"></a>
</h4>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">allBenchmarks</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="fu">get_confusion_FDRvsFDP</span><span class="op">(</span><span class="op">)</span>; <span class="va">res</span><span class="op">$</span><span class="va">name</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">model_name</span>;<span class="va">res</span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dd</span> <span class="op">|&gt;</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">FDP_</span>,  x  <span class="op">=</span> <span class="va">scorecol</span> <span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">model_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">contrast</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="BenchmarkingIonstarData_files/figure-html/FDRfdp-1.png" alt="Compare FDR estimate with false discovery proportion (FDP)." width="768"><p class="caption">
Compare FDR estimate with false discovery proportion (FDP).
</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
